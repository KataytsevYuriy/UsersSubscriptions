@model AppUser
@{
    Layout = "_StudentLayout";
}
@{
    int thisYear = DateTime.Now.Year;
    int thisMonth = DateTime.Now.Month;
}
<div class="bg-primary text-center text-info"><h3>All Your Courses </h3></div>
@if (ViewBag.Result != null && ViewBag.Result)
{
        <div class="bg-success text-center"><h4>Thanks for choosing our school</h4></div>
}
 @if (ViewBag.ErorMessage!=null)
    {
        <div class="bg-danger text-center"><h4>@ViewBag.ErorMessage</h4></div>
    }

<div class="bg-info text-center"><H4>Active Courses</H4></div>
<table class="table table-striped table-bordered">
    <tr><th>Course Name</th><th>Course Description</th><th>Course Teachers</th><th>Price</th><th>Date</th></tr>
    @foreach (Subscription subscription in Model.Subscriptions)
    {
        @if ((thisYear == subscription.DayStart.Year && thisMonth <= subscription.DayStart.Month)
     || (thisYear < subscription.DayStart.Year))
        {
            <tr>
                <td>
                    @subscription.Course.Name
                    @if (subscription.ConfirmedBy == null)
                    {
                        <br />
                        <span class="text-danger">Unconfirmed</span>
                    }
                </td>
                <td>@subscription.Course.Description</td>
                <td>
                    @if (subscription.Course.CourseAppUsers != null && subscription.Course.CourseAppUsers.Count() > 0)
                    {
                        @foreach (CourseAppUser teacher in subscription.Course.CourseAppUsers)
                        {
                            <span>@teacher.AppUser.FullName </span> <br>
                        }
                    }
                </td>
                <td>@subscription.Price</td>
                <td>
                    @subscription.DayStart.ToString("MMM/yyyy") <br>
                    <a asp-action="AddToCourse" asp-route-Id="@subscription.CourseId"
                       class="btn btn-primary">Add new Subscription</a>
                    @*Allow remove only not confirmed Subscription*@
                    @if (subscription.ConfirmedBy == null)
                    {
                        <br />
                        <a asp-action="RemoveSubscription" asp-route-Id="@subscription.Id"
                           class="btn btn-danger">Remove Subscription</a>
                    }
                </td>
            </tr>
        }
    }
</table>
<br />
<div class="bg-info text-center"><H4>Losted Courses</H4></div>

<table class="table table-striped table-bordered">
    <tr><th>Course Name</th><th>Course Description</th><th>Course Teachers</th><th>Price</th><th>Date</th></tr>
    @foreach (Subscription subscription in Model.Subscriptions)
    {
        @if (!((thisYear == subscription.DayStart.Year && thisMonth <= subscription.DayStart.Month)
     || (thisYear < subscription.DayStart.Year)))
        {
            <tr>
                <td>@subscription.Course.Name</td>
                <td>@subscription.Course.Description</td>
                <td>
                    @if (subscription.Course.CourseAppUsers != null && subscription.Course.CourseAppUsers.Count() > 0)
                    {
                        @foreach (CourseAppUser teacher in subscription.Course.CourseAppUsers)
                        {
                            <span>@teacher.AppUser.FullName </span> <br>
                        }
                    }
                </td>
                <td>@subscription.Price</td>
                <td>
                    @subscription.DayStart.ToString("MMMM/yyyy") <br>
                    <a asp-action="AddToCourse" asp-route-Id="@subscription.CourseId" class="btn btn-primary">Add new Subscription</a>
                </td>
            </tr>
        }
    }
</table>