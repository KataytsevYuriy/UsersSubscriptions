
@{
    Layout = "_Layout";
}

<br />
<p style="font-size:1.2em">
    Відскануйте QR код абонементу
</p>
<div id="area-cameras-list">
</div>
<video id="preview" style="width:100%;height:50%;"></video>
@section Scripts{
    <script type="text/javascript">
    var getUserInfoUrl = '@Url.Action("StudentInfo")';
    var cameras;
    var scanner;

    $(function () {
        $.getScript("/js/instascan.min.js", function () {
            scanner = new Instascan.Scanner({ video: document.getElementById('preview'), mirror: false });
            scanner.addListener('scan', function (content) {
                window.location.href = getUserInfoUrl + "?studentId=" + content;
            });
            debugger;
            Instascan.Camera.getCameras().then(function (camerasList) {
                cameras = camerasList;
                if (cameras.length > 0) {
                    if (cameras.length > 1) {
                        var camerasArea = $("#area-cameras-list");
                        for (var i = 0; i < cameras.length; i++) {
                            if (i == cameras.length - 1) {
                                camerasArea.append("<a class='list-group-item active' href='#' data-camera-id='" + cameras[i].id + "'>" + cameras[i].name + "</a><br/>")
                            }
                            else {
                                camerasArea.append("<a class='list-group-item' href='#' data-camera-id='" + cameras[i].id + "'>" + cameras[i].name + "</a><br/>")
                            }
                        }
                    }
                    scanner.start(cameras[cameras.length - 1]);
                } else {
                    console.error('No cameras found.');
                }
            }).catch(function (e) {
                console.error(e);
            });
        });

        $("body").on('click', '#area-cameras-list a', function () {
            $(".list-group-item").removeClass("active");
            debugger;
            $(this).addClass('active');
            var cameraId = $(this).attr('data-camera-id');
            var activeCamera = cameras.find(x => x.id === cameraId);
            debugger;
            scanner.start(activeCamera);
        });
    });
    </script>
}
